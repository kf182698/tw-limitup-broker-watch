name: Daily Stock Watch (å°ç£æ™‚é–“ 18:00 åŸ·è¡Œ)

permissions:
  contents: write

on:
  schedule:
    - cron: '0 10 * * 1-5'
  workflow_dispatch:

jobs:
  run-daily-analysis:
    runs-on: ubuntu-latest
    steps:
      - name: æª¢æŸ¥ç¨‹å¼ç¢¼
        uses: actions/checkout@v4

      - name: è¨­å®š Python ç’°å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: å®‰è£ä¾è³´
        run: pip install -r requirements.txt

      - name: å»ºç«‹æ•¸æ“šç›®éŒ„èˆ‡ç©ºæª”
        run: |
          mkdir -p data_raw data_clean
          touch data_raw/.gitkeep
          touch data_clean/.gitkeep

      - name: åŸ·è¡Œè…³æœ¬
        env:
          EMAIL_USERNAME: ${{ secrets.EMAIL_USERNAME }}
          EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
          EMAIL_TO: ${{ secrets.EMAIL_TO }}
        run: |
          export TZ='Asia/Taipei'
          TODAY_DATE=$(date +%Y-%m-%d)
          python -m src.app.main run --date $TODAY_DATE

      - name: è‡ªå‹• Commit çµæœ
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_options: --allow-empty
          file_pattern: data_raw/* data_raw/.gitkeep data_clean/* data_clean/.gitkeep
          commit_message: "ğŸ¤– æ•¸æ“šè‡ªå‹•æäº¤ï¼šæ›´æ–°æ¯æ—¥ç›£æ§çµæœ"
          skip_dirty_check: true
          repository: .
          commit_user_name: github-actions[bot]
          commit_user_email: 41898282+github-actions[bot]@users.noreply.github.com
          commit_author: "*** <221647913+***@users.noreply.github.com>"
          skip_fetch: false
          skip_checkout: false
          disable_globbing: false
          create_branch: false
          create_git_tag_only: false
          internal_git_binary: git
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

