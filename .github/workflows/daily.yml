name: Daily Limit-Up Broker Watch

on:
  schedule:
    # 每天 18:45 (台灣時間) 執行
    - cron: "45 10 * * *"   # UTC+0 → 台灣 UTC+8 = 18:45
  workflow_dispatch: {}

jobs:
  run:
    runs-on: ubuntu-latest

    env:
      TZ: Asia/Taipei
      EMAIL_USERNAME: ${{ secrets.EMAIL_USERNAME }}
      EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
      EMAIL_TO: ${{ secrets.EMAIL_TO }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set timezone
        run: sudo timedatectl set-timezone Asia/Taipei

      - name: Display current time
        run: date

      - name: Install Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run Limit-Up Broker Watch script
        run: |
          echo "==== Running script ===="
          python src/app/main.py --date today

      - name: Job completed
        run: echo "==== Workflow finished ===="
